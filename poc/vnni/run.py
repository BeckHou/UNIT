import subprocess

#workloads = [(1024,16,16,2048,1024,1,1,1,1),
#(960,8,8,160,960,1,1,1,1),
#(256,56,56,512,256,1,1,1,1),
#(64,56,56,128,64,1,1,1,1),
#(512,10,10,512,512,3,3,1,1),
#(192,16,16,160,192,3,3,1,1),
#(64,65,65,128,64,3,3,1,1),
#(320,65,65,384,320,3,3,1,1),
#(384,8,8,384,384,1,3,1,1),
#(192,23,23,192,192,7,1,1,1),
#(3,224,224,64,3,7,7,2,2),
#(1024,15,15,2048,1024,1,1,2,2),
#(128,65,65,256,128,3,3,2,2)]
#
#workloads = [(1, 288, 35, 35, 384, 288, 3, 3, 2, 2), (1, 160, 9, 9, 224, 160, 3, 3, 1, 1), (1, 1056, 7, 7, 192, 1056, 1, 1, 1, 1), (1, 80, 73, 73, 192, 80, 3, 3, 1, 1), (1, 128, 16, 16, 128, 128, 3, 3, 1, 1), (1, 192, 16, 16, 192, 192, 3, 3, 1, 1), (1, 256, 16, 16, 256, 256, 3, 3, 1, 1), (1, 1024, 14, 14, 512, 1024, 1, 1, 1, 1), (1, 128, 16, 16, 160, 128, 3, 3, 1, 1), (1, 576, 14, 14, 192, 576, 1, 1, 1, 1), (1, 96, 16, 16, 128, 96, 3, 3, 1, 1), (1, 1024, 14, 14, 256, 1024, 1, 1, 1, 1), (1, 576, 14, 14, 128, 576, 1, 1, 1, 1), (1, 64, 29, 29, 96, 64, 3, 3, 1, 1), (1, 64, 56, 56, 128, 64, 1, 1, 2, 2), (1, 608, 14, 14, 192, 608, 1, 1, 1, 1)]

workloads = [
(256, 16, 16, 256, 3, 1),
(512, 9, 9, 512, 3, 1),
(128, 30, 30, 128, 3, 1),
(64, 56, 56, 128, 1, 2),
(64, 58, 58, 64, 3, 1),
(128, 28, 28, 256, 1, 2),
(256, 16, 16, 512, 3, 2),
(64, 58, 58, 128, 3, 2),
(4, 230, 230, 64, 7, 2),
(128, 30, 30, 256, 3, 2),
(256, 14, 14, 512, 1, 2)
]

for i in workloads:
    exec_time = []
    with open('input', 'w') as f:
        lst = list(i)
        #for j in (i[1:5] + i[6:]):
        #    f.write(str(j) + '\n')
        f.write(str(i[0]) + '\n')
        f.write(str(i[1]) + '\n')
        f.write(str(i[2]) + '\n')
        f.write(str(i[3]) + '\n')
        f.write(str(i[4]) + '\n')
        f.write(str(i[4]) + '\n')
        f.write(str(i[5]) + '\n')
        f.write(str(i[5]) + '\n')
    try:
        avg = []
        for j in range(10):
            res = subprocess.check_output('./mkldnn_conv.out < input', shell=True).decode('utf-8')
            res = res.split('\n')[1]
            res = res.lstrip('Exec time: ').rstrip('us')
            res = float(res) * 1e6
            res = int(res)
            avg.append(res)
        exec_time.append(sum(avg) / len(avg))
    except:
        print(i, 'fails')
    print(i, min(exec_time))

